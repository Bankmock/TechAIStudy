<!DOCTYPE html>
<html lang="en">
<head>
        <script defer src="../../js/component1.js"></script>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="index, follow">
  <link rel="icon" href="https://techaistudy.com/images/logo.webp" type="image/webp">  
<title>Twitter X Video Downloader - Download from Instagram, Facebook, Twitter, YouTube, Tiktok, etc</title>
   <link rel="stylesheet" href="../../css/header.css">
  <link rel="stylesheet" href="../../css/blogpost.css">
  <link rel="stylesheet" href="../../css/footer.css">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WEZ36N4FPF"></script>
  <script src="../../js/ads.js"></script>
  <script src="../../js/headerScript.js"></script>
  <script src="../../js/googletrackingid.js"></script> 

<style>

/* HEADER */
#headerTable{
  width:100%;
  margin:20px auto 30px;
}
#headerTable td{
  vertical-align:middle;
}
#videoThumb{
  width:180px;
  border-radius:10px;
}
#videoTitle{
  font-size:20px;
  font-weight:bold;
  padding-left:20px;
  text-align:left;
}

/* TABLES */
h2{
  background:#ff4d4d;
  padding:10px;
  color:white;
  border-radius:6px;
  width:80%;
  margin:25px auto 10px;
}
table.data{
  width:100%;
  margin:auto;
  border-collapse:collapse;
  margin-bottom:30px;
}
table.data th,table.data td{
  padding:10px;
  border:1px solid #ccc;
  text-align:center;
}

/* BUTTONS */
.btn{
  background:green;
  color:white;
  padding:8px 16px;
  border:none;
  border-radius:5px;
  cursor:pointer;
}
.audio-btn{background:green}

/* FETCH LOADER */
#fetchBox{
  position:fixed;
  inset:0;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:10px;
}
#fetchProgress{
  width:260px;
  height:14px;
  background:#e5e7eb;
  border-radius:8px;
}
#fetchBar{
  height:100%;
  width:0%;
  background:#22c55e;
}

/* DOWNLOAD PROGRESS */
#progressBox{
  position:fixed;
  right:20px;
  bottom:90px;
  width:260px;
  background:#e5e7eb;
  border-radius:8px;
  display:none;
}
#progressBar{
  height:14px;
  width:0%;
  background:#22c55e;
}

/* TOAST */
#toast{
  position:fixed;
  right:20px;
  bottom:20px;
  background:#f8fff9;
  color:#0f172a;
  padding:14px 18px;
  border-radius:8px;
  min-width:260px;
  display:none;
  white-space:pre-line;
  border:2px solid #22c55e;
}
</style>
</head>

<body>
<div class="ads"><script type="text/javascript">
        atOptions = {
                'key' : 'd989003ea8480512c7e859e4a01a08d2',
                'format' : 'iframe',
                'height' : 90,
                'width' : 728,
                'params' : {}
        };
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/d989003ea8480512c7e859e4a01a08d2/invoke.js"></script></div>
<div class="container">
<!-- FETCHING -->
<div id="fetchBox">
  <div>üîç Fetching formats‚Ä¶</div>
  <div id="fetchProgress"><div id="fetchBar"></div></div>
  <div id="fetchText">0%</div>
</div>

<!-- HEADER -->
<table id="headerTable">
  <tr>
    <td width="200"><img id="videoThumb"></td>
    <td id="videoTitle"><span id="title"></span></td>
  </tr>
</table>

<div id="content"></div>

<div id="progressBox"><div id="progressBar"></div></div>
<div id="toast"></div>
</div>
<script>
const SERVER = "https://videosaver.linkpc.net";

/* FETCH UI */
const fetchBox = document.getElementById("fetchBox");
const fetchBar = document.getElementById("fetchBar");
const fetchText = document.getElementById("fetchText");

function updateFetch(p){
  fetchBar.style.width = p + "%";
  fetchText.innerText = p + "%";
}

/* FETCH FORMATS */
const videoUrl = new URLSearchParams(location.search).get("url");
(async()=>{
  updateFetch(20);
  const r = await fetch(`${SERVER}/api/formats?url=${encodeURIComponent(videoUrl)}`);
  updateFetch(80);
  const d = await r.json();
  updateFetch(100);
  fetchBox.style.display="none";
  render(d);
})();

function mb(x){ return x ? (x/1048576).toFixed(2)+" MB" : "Unknown"; }

/* RENDER */
function render(d){
  title.innerText = d.title;
  videoThumb.src = d.thumbnail;

  let html = "";

  if(d.best_video){
    html += `
    <h2>üé• Best Video</h2>
    <table class="data">
      <tr><th>Resolution</th><th>Size</th><th>Download</th></tr>
      <tr>
        <td>${d.best_video.resolution}</td>
        <td>${mb(d.best_video.filesize)}</td>
        <td>
          <button class="btn dl"
            data-url="${encodeURIComponent(d.best_video.url)}"
            data-name="${encodeURIComponent(d.title)}.mp4">
            Download
          </button>
        </td>
      </tr>
    </table>`;
  }

  if(d.other_videos && d.other_videos.length){
    html += `
    <h2>üé¨ Video Formats</h2>
    <table class="data">
      <tr><th>Resolution</th><th>Size</th><th>Download</th></tr>`;
    d.other_videos.forEach(v=>{
      html += `
      <tr>
        <td>${v.resolution}</td>
        <td>${mb(v.filesize)}</td>
        <td>
          <button class="btn dl"
            data-url="${encodeURIComponent(v.url)}"
            data-name="${encodeURIComponent(d.title)}.${v.ext}">
            Download
          </button>
        </td>
      </tr>`;
    });
    html += `</table>`;
  }

  html += `
  <h2>üéß Audio Formats</h2>
  <table class="data">
    <tr><th>Bitrate</th><th>Size</th><th>Download</th></tr>`;
  d.audio_formats.forEach(a=>{
    html += `
    <tr>
      <td>${a.bitrate||"??"} kbps</td>
      <td>${mb(a.filesize)}</td>
      <td>
        <button class="btn audio-btn dl"
          data-url="${encodeURIComponent(a.url)}"
          data-name="${encodeURIComponent(d.title)}.${a.ext}">
          Download
        </button>
      </td>
    </tr>`;
  });
  html += `</table>`;

  content.innerHTML = html;
}

/* SAFE CLICK */
document.addEventListener("click",e=>{
  if(e.target.classList.contains("dl")){
    const url = decodeURIComponent(e.target.dataset.url);
    const name = decodeURIComponent(e.target.dataset.name);
    download(url,name);
  }
});

/* DOWNLOAD WITH ETA */
async function download(url, filename){
  const toast = document.getElementById("toast");
  const pBox = document.getElementById("progressBox");
  const pBar = document.getElementById("progressBar");

  toast.style.display="block";
  pBox.style.display="block";
  toast.innerText="üìÅ DOWNLOADING‚Ä¶";

  const res = await fetch(
    `${SERVER}/stream?url=${encodeURIComponent(url)}&filename=${encodeURIComponent(filename)}`
  );

  const total = Number(res.headers.get("Content-Length"));
  const reader = res.body.getReader();

  let received = 0;
  const start = Date.now();
  const chunks = [];

  while(true){
    const {done,value} = await reader.read();
    if(done) break;

    chunks.push(value);
    received += value.length;

    const elapsed = (Date.now()-start)/1000;
    const speed = (received/1024/elapsed).toFixed(2);

    if(total && total > 0){
      const percent = Math.floor(received/total*100);
      pBar.style.width = percent+"%";
      const eta = ((total-received)/1024/speed)|0;
      toast.innerText =
`üìÅ DOWNLOADING ${percent}%
üöÄ Speed: ${speed} KiB/s
‚è≥ ETA: ${formatTime(eta)}`;
    }else{
      toast.innerText =
`üìÅ DOWNLOADING
üöÄ Speed: ${speed} KiB/s
üì¶ ${(received/1048576).toFixed(2)} MB`;
    }
  }

  const blob = new Blob(chunks);
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();

  toast.innerText="‚úÖ Download complete";
  setTimeout(()=>{
    toast.style.display="none";
    pBox.style.display="none";
    pBar.style.width="0%";
  },2000);
}

function formatTime(sec){
  const m = Math.floor(sec/60);
  const s = sec % 60;
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
</script>

</body>
</html>
