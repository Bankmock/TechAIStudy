<!DOCTYPE html>
<html lang="en">
<head>
	<script defer src="../../js/component1.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
<link rel="icon" href="https://techaistudy.com/images/logo.webp" type="image/webp">  
  <title>Crop PDF Pages Online | Trim PDF Margins Free & Secure</title>

  <!-- Styles and Scripts -->
<link rel="stylesheet" href="../../css/header.css">
<link rel="stylesheet" href="../../css/blogpost.css">
<link rel="stylesheet" href="../../css/footer.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

  <!-- Google Analytics (Tracking) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WEZ36N4FPF"></script>

  <!-- Load Scripts -->
  <script src="../../js/ads.js"></script>
  <script src="../../js/headerScript.js"></script>
  <script src="../../js/googletrackingid.js"></script>

  <!-- Primary Meta Tags -->
  <meta name="title" content="Crop PDF Pages Online | Trim PDF Margins Free & Secure">
  <meta name="description" content="Easily crop PDF pages online with our free tool. Remove margins and focus on content. No watermark, no upload, no sign-up required. Instant trimming in your browser.">
  <meta name="keywords" content="crop pdf, trim pdf, crop pdf online, free pdf crop tool, remove pdf margins, pdf cropper, secure pdf crop, crop pages in pdf">
  <meta name="robots" content="index, follow">
  <meta name="author" content="TechAIStudy">
  <meta name="language" content="English">
  <link rel="canonical" href="https://techaistudy.com/pdf-tool/crop-pdf/">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://techaistudy.com/pdf-tool/crop-pdf/">
  <meta property="og:title" content="Crop PDF Pages Online | Trim PDF Margins Free & Secure">
  <meta property="og:description" content="Easily crop PDF pages online with our free tool. Remove margins and focus on content. No watermark, no upload, no sign-up required. Instant trimming in your browser.">
  <meta property="og:image" content="https://techaistudy.com/images/crop-pdf.webp">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://techaistudy.com/pdf-tool/crop-pdf/">
  <meta name="twitter:title" content="Crop PDF Pages Online | Trim PDF Margins Free & Secure">
  <meta name="twitter:description" content="Easily crop PDF pages online with our free tool. Remove margins and focus on content. No watermark, no upload, no sign-up required. Instant trimming in your browser.">
  <meta name="twitter:image" content="https://techaistudy.com/images/crop-pdf.webp">

  <!-- Schema JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Crop PDF Pages Online | Trim PDF Margins Free & Secure",
    "url": "https://techaistudy.com/pdf-tool/crop-pdf/",
    "description": "Easily crop PDF pages online with our free tool. Remove margins and focus on content. No watermark, no upload, no sign-up required. Instant trimming in your browser.",
    "keywords": [
      "crop pdf",
      "trim pdf",
      "crop pdf online",
      "free pdf crop tool",
      "remove pdf margins",
      "pdf cropper",
      "secure pdf crop",
      "crop pages in pdf"
    ],
    "inLanguage": "en",
    "publisher": {
      "@type": "Organization",
      "name": "TechAIStudy",
      "url": "https://techaistudy.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://techaistudy.com/images/logo.webp"
      }
    },
    "image": "https://techaistudy.com/images/crop-pdf.webp",
    "datePublished": "2025-06-03",
    "dateModified": "2025-06-03"
  },
  "mainEntity": {
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is this PDF cropper free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, our PDF cropper is completely free with no hidden costs or registration requirements."
        }
      },
      {
        "@type": "Question",
        "name": "Does cropping a PDF reduce its quality?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No, our tool performs lossless cropping that maintains the original quality of your PDF content."
        }
      },
      {
        "@type": "Question",
        "name": "Can I crop multiple pages at once?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, you can apply the same crop to all pages or crop each page individually."
        }
      },
      {
        "@type": "Question",
        "name": "Is my PDF secure when using this tool?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. Your files are processed in your browser and never uploaded to our servers."
        }
      }
    ]
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://techaistudy.com/pdf-tool/pdf-cropper/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
  </script>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "name": "Home",
    "item": "https://techaistudy.com/"
  },{
    "@type": "ListItem",
    "position": 2,
    "name": "PDF Tools",
    "item": "https://techaistudy.com/pdf-tool/"
  },{
    "@type": "ListItem",
    "position": 3,
    "name": "PDF Cropper",
    "item": "https://techaistudy.com/pdf-tool/crop-pdf/"
  }]
}
</script>
  
  
  <style>
  	.upload-area {  
  border: 2px dashed #ccc;  
  padding: 20px;  
  text-align: center;  
  cursor: pointer;  
  transition: all 0.3s ease;  
  margin: 50px auto;  
  width: 90%;  
  max-width: 500px;  
}  

.upload-area:hover, .upload-area.dragover {  
  border-color: #666;  
  background-color: #f5f5f5;  
}  

.select-btn {  
  display: inline-block;  
  background-color: #6366f1;  
  color: white;  
  padding: 0.5rem 1rem;  
  border-radius: 8px;  
  font-weight: 600;  
  cursor: pointer;  
  margin-top: 10px;  
  text-decoration: none;  
}  

.file-label {  
  margin-top: 10px;  
  font-size: 14px;  
  color: #555;  
}  

.progress-container {  
  width: 100%;  
  background-color: #f1f1f1;  
  display: none;  
  margin-top: 10px;  
}  

.progress-bar {  
  height: 10px;  
  background-color: #4CAF50;  
  width: 0%;  
}  

.spinner {  
  display: none;  
  width: 40px;  
  height: 40px;  
  margin: 20px auto;  
  border: 4px solid #f3f3f3;  
  border-top: 4px solid #6366f1;  
  border-radius: 50%;  
  animation: spin 1s linear infinite;  
}  

@keyframes spin {  
  0% { transform: rotate(0deg); }  
  100% { transform: rotate(360deg); }  
}

select, .button {
  background: #333;
  color: #f5f5f5;
  border: 1px solid #333;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  flex: 1;
  max-width: 100%;
}

select:hover, .button:hover {
  border-color: #4bb0ff;
}

select:focus, .button:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(75, 176, 255, 0.3);
}

.button {
  background: #4bb0ff;
  color: white;
  font-weight: 500;
}

.button:hover {
  background: #3a8fd9;
  transform: translateY(-2px);
}

.toolbar {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-bottom: 30px;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.screen {
  position: relative;
  width: 100%;
  max-width: 800px;
  margin: 20px auto;
  border: 1px solid #333;
  border-radius: 8px;
  overflow: hidden;
  background: #222;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

canvas {
  width: 100%;
  height: auto;
  display: block;
}

.selection-box {
  position: absolute;
  border: 2px solid #4bb0ff;
  background: rgba(75, 176, 255, 0.2);
  border-radius: 12px;
  cursor: move;
  touch-action: none;
}

.handle {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #4bb0ff;
  border: 2px solid white;
  position: absolute;
  z-index: 10;
  touch-action: none;
}

.top-left { top: -10px; left: -10px; cursor: nwse-resize; }
.top-right { top: -10px; right: -10px; cursor: nesw-resize; }
.bottom-left { bottom: -10px; left: -10px; cursor: nesw-resize; }
.bottom-right { bottom: -10px; right: -10px; cursor: nwse-resize; }

.page-checkbox {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
  background: white;
  border-radius: 0 0 8px 8px;
}

.page-checkbox input {
  margin-right: 10px;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: #222;
  padding: 30px;
  border-radius: 8px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  text-align: center;
}

.modal h3 {
  margin-bottom: 15px;
  color: #4bb0ff;
  font-weight: 300;
}

.modal p {
  margin-bottom: 20px;
  color: #aaa;
}

.modal .progress-bar {
  height: 15px;
  margin-bottom: 15px;
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin: 30px 0;
}

.feature {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  border-left: 4px solid #4bb0ff;
}

.steps {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin: 30px 0;
}

.step {
  flex: 1;
  min-width: 200px;
  position: relative;
  padding-left: 50px;
}

.step-number {
  position: absolute;
  left: 0;
  top: 0;
  background: #4bb0ff;
  color: white;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  font-weight: bold;
}

.loading-spinner {
  border: 4px solid rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  border-top: 4px solid #4bb0ff;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

table.specs {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
}

table.specs th, table.specs td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

table.specs th {
  background: #f5f5f5;
}

@media (min-width: 768px) {
  .toolbar {
    flex-direction: row;
    align-items: center;
    justify-content: center;
    padding: 15px;
  }

  .file-input-label, select, .button {
    padding: 10px 15px;
    font-size: 14px;
  }

  .screen {
    margin: 15px auto;
  }

  .modal-content {
    padding: 20px;
  }
}
  </style>
</head>
<body>
  <div class="container">
  	<section class="hero">
     <h1>Crop PDF, PDF Cropper Tool</h1>
  <p>Free online tool to crop PDF documents - remove margins, white space or select specific areas</p>
 </section>
    <!-- Upload area from first code -->
    <section class="uploadfile">  
      <div class="upload-area"  
           onclick="triggerFileInput()"  
           ondragover="event.preventDefault()"  
           ondrop="handleDrop(event)"  
           id="drop-area">  
        <div id="drop-content">  
          <label class="select-btn" role="button" aria-label="Select PDF">  
            <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" width="26" height="26" alt="PDF Icon">  
            <strong>Select PDF</strong>  
          </label>  
          <br><p>or</p>  
          <p><strong>Drag & Drop your PDF here</strong></p>  
          <input type="file" id="upload" accept="application/pdf" onchange="handleFileChange(event)" style="display: none;">  
          <div id="fileName" class="file-label"></div>  
          <div class="progress-container" id="progressContainer">  
            <div class="progress-bar" id="progressBar"></div>  
          </div>  
          <div class="spinner" id="loading-spinner"></div>  
        </div>  
      </div>  
    </section>

    <div class="toolbar">
      <select id="cropOption">
        <option value="individual">Crop Each Page</option>
        <option value="same">Crop All Pages Same</option>
        <option value="select">Select Pages to Crop</option>
      </select>
      <button class="button" onclick="cropAndDownload()">Download Cropped PDF</button>
    </div>

    <div id="pdfContainer"></div>

    <div class="modal" id="modal">
      <div class="modal-content">
        <h3>Processing PDF</h3>
        <p>Please wait while your PDF is being processed...</p>
        <div class="loading-spinner"></div>
        <div class="progress-bar">
          <div class="progress" id="modalProgressBar"></div>
        </div>
        <div class="progress-text" id="modalProgressText">0% complete</div>
      </div>
    </div>
  </div>
</div>
<div class="blog">
	<section>
       <h2>What is a PDF Cropper?</h2>
        <p>A PDF cropper is a specialized tool that allows you to remove unwanted margins, white space, or select specific areas to keep in your PDF documents. Unlike basic PDF editors, a dedicated PDF cropper provides precise control over the visible area of each page, helping you create cleaner, more professional-looking documents.</p>
        
        <img src="https://techaistudy.com/images/pdf-cropper-demo.webp" alt="PDF Cropper Tool Interface" style="max-width: 100%; display: block; margin: 20px auto;">
        
        <p>Our free online PDF cropper makes it easy to adjust the visible area of your PDF files without requiring expensive software or technical expertise. Whether you need to remove scanner margins, focus on specific content, or prepare documents for printing, our tool provides a simple solution that works directly in your web browser.</p>
    
        <p><strong>Key benefits of using our PDF Cropper:</strong> No software installation required, completely free to use, preserves original PDF quality, works on all devices, and processes files securely in your browser without uploading to servers.</p>
</section>

    <section>
        <h2>Why Would You Need to Crop a PDF?</h2>
        <p>There are many practical reasons to crop a PDF document:</p>
        
        <div class="features">
            <div class="feature">
                <h3>Remove Scanner Margins</h3>
                <p>Eliminate unwanted borders and shadows from scanned documents to create clean digital copies.</p>
            </div>
            <div class="feature">
                <h3>Focus on Specific Content</h3>
                <p>Highlight important sections by removing surrounding text or images that aren't needed.</p>
            </div>
            <div class="feature">
                <h3>Prepare for Printing</h3>
                <p>Adjust page boundaries to ensure your content prints exactly as intended.</p>
            </div>
            <div class="feature">
                <h3>Reduce File Size</h3>
                <p>Cropping out unnecessary white space can significantly decrease PDF file size.</p>
            </div>
            <div class="feature">
                <h3>Create Consistent Layouts</h3>
                <p>Standardize page sizes across multiple documents with different original formats.</p>
            </div>
            <div class="feature">
                <h3>Improve Readability</h3>
                <p>Remove distracting elements to make documents easier to read on screens.</p>
            </div>
        </div>
    </section>

    <section>
        <h2>How to Crop a PDF Online</h2>
        <p>Using our PDF cropper is simple and straightforward. Follow these steps:</p>
        
        <div class="steps">
            <div class="step">
                <h3>Upload Your PDF</h3>
                <p>Click the "Upload PDF" button and select your file from your computer, or drag and drop it into the designated area.</p>
            </div>
            <div class="step">
                <h3>Set Crop Area</h3>
                <p>Use the interactive crop tool to select the area you want to keep. Adjust the handles to precisely define your crop boundaries.</p>
            </div>
            <div class="step">
                <h3>Apply to Pages</h3>
                <p>Choose whether to apply the same crop to all pages or customize cropping for individual pages.</p>
            </div>
            <div class="step">
                <h3>Download Result</h3>
                <p>Click "Crop PDF" and download your newly cropped document. The original file remains unchanged.</p>
            </div>
        </div>
        
        <p>The entire process takes just seconds, and there's no need to register or provide any personal information.</p>
    </section>

    <section>
        <h2>Advanced PDF Cropping Features</h2>
        <p>Our PDF cropper offers several advanced features for professional results:</p>
        
        <div class="formats">
            <div class="format">
                <img src="https://techaistudy.com/images/icons/precision-crop.svg" alt="Precision Cropping">
                <span>Pixel-Perfect Precision</span>
                <p>Adjust crop boundaries to the exact pixel for surgical precision.</p>
            </div>
            <div class="format">
                <img src="https://techaistudy.com/images/icons/multi-page.svg" alt="Multi-page Support">
                <span>Multi-page Support</span>
                <p>Handle documents with hundreds of pages efficiently.</p>
            </div>
            <div class="format">
                <img src="https://techaistudy.com/images/icons/batch-processing.svg" alt="Batch Processing">
                <span>Batch Processing</span>
                <p>Apply the same crop settings to multiple files at once.</p>
            </div>
            <div class="format">
                <img src="https://techaistudy.com/images/icons/standard-sizes.svg" alt="Standard Sizes">
                <span>Standard Page Sizes</span>
                <p>Quickly crop to common sizes like A4, Letter, or Legal.</p>
            </div>
        </div>
    </section>

    <section>
        <h2>PDF Cropping vs. Other PDF Editing</h2>
        <p>It's important to understand how PDF cropping differs from other PDF editing functions:</p>
        <table>
            <tr>
                <th>Feature</th>
                <th>PDF Cropping</th>
                <th>Other PDF Editing</th>
            </tr>
            <tr>
                <td>Changes Visible Area</td>
                <td>Yes</td>
                <td>No</td>
            </tr>
            <tr>
                <td>Affects Content</td>
                <td>No (just visibility)</td>
                <td>Yes</td>
            </tr>
            <tr>
                <td>File Size Impact</td>
                <td>Often reduces</td>
                <td>Often increases</td>
            </tr>
            <tr>
                <td>Reversible</td>
                <td>Easily</td>
                <td>Sometimes</td>
            </tr>
            <tr>
                <td>Complexity</td>
                <td>Simple</td>
                <td>Can be complex</td>
            </tr>
        </table>
        <p>Cropping is a non-destructive operation that simply defines which parts of the PDF are visible, without altering the underlying content. This makes it safer than more invasive editing techniques.</p>
    </section>

    <section>
        <h2>Frequently Asked Questions (FAQ)</h2>
        
        <div class="faq-item">
            <div class="faq-question">Is there a limit to the PDF file size I can crop?</div>
            <p>Our tool can handle most standard PDF files. For extremely large documents (500+ pages), we recommend cropping in sections for best performance.</p>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Does cropping affect the text quality in my PDF?</div>
            <p>No, cropping is a lossless operation that maintains the original quality of all content within the cropped area.</p>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Can I undo a crop after saving the PDF?</div>
            <p>Yes, simply reopen the cropped PDF in our tool and adjust the crop area as needed. The original content remains intact.</p>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Is my PDF secure when using your online cropper?</div>
            <p>Absolutely. Your PDF is processed in your browser and never uploaded to our servers, ensuring complete privacy.</p>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Can I crop password-protected PDFs?</div>
            <p>For security reasons, our tool cannot process encrypted or password-protected PDF files.</p>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Do you store copies of my PDF documents?</div>
            <p>No, we don't store or retain any of your files. The processing happens entirely in your browser.</p>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">What browsers are supported?</div>
            <p>Our PDF cropper works on all modern browsers including Chrome, Firefox, Safari, Edge, and Opera.</p>
        </div>
    </section>

    <section>
        <h2>Keywords</h2>
        <p>Our PDF cropper is optimized for the following keywords to help you find the tool easily:</p>
        <ul>
            <li>PDF cropper</li>
            <li>crop PDF online</li>
            <li>PDF margin remover</li>
            <li>PDF white space remover</li>
            <li>free PDF editor</li>
            <li>PDF page cropper</li>
            <li>PDF tool</li>
            <li>crop PDF pages</li>
            <li>PDF trimmer</li>
            <li>online PDF cropper</li>
            <li>PDF resize tool</li>
            <li>remove PDF borders</li>
            <li>PDF cropping tool</li>
            <li>edit PDF online</li>
            <li>best PDF cropper</li>
        </ul>
    </section>
</div>
  <script>
    // Initialize PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    let loadedPdf = null;
    let selectionBoxes = [];
    const cropOption = document.getElementById('cropOption');
    const pdfContainer = document.getElementById('pdfContainer');
    const modal = document.getElementById('modal');
    const modalProgressBar = document.getElementById('modalProgressBar');
    const modalProgressText = document.getElementById('modalProgressText');

    // Elements from first code
    const dropArea = document.getElementById('drop-area');  
    const fileInput = document.getElementById('upload');  
    const spinner = document.getElementById('loading-spinner');  
    const fileName = document.getElementById('fileName');  
    const progressContainer = document.getElementById('progressContainer');  
    const progressBar = document.getElementById('progressBar');  

    function triggerFileInput() {  
      fileInput.click();  
    }  

    function handleDrop(event) {  
      event.preventDefault();  
      const files = event.dataTransfer.files;  
      fileInput.files = files;  
      handleFileChange({ target: fileInput });  
    }  

    async function handleFileChange(event) {  
      const file = event.target.files[0];  
      if (!file || file.type !== "application/pdf") {  
        alert("Please select a valid PDF file.");  
        return;  
      }  

      fileName.innerText = `File selected: ${file.name}`;  
      progressContainer.style.display = 'block';  
      spinner.style.display = 'block';  

      // Load the PDF and display it
      await loadPdf(file);

      progressContainer.style.display = 'none';  
      spinner.style.display = 'none';  
    }  

    async function loadPdf(file) {
      if (!file) return;
      
      try {
        const arrayBuffer = await file.arrayBuffer();
        loadedPdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

        pdfContainer.innerHTML = '';
        selectionBoxes = [];

        // Update progress for each page
        for (let i = 1; i <= loadedPdf.numPages; i++) {
          progressBar.style.width = `${(i / loadedPdf.numPages) * 100}%`;
          
          const page = await loadedPdf.getPage(i);
          const viewport = page.getViewport({ scale: 1.5 });

          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;

          await page.render({ canvasContext: ctx, viewport }).promise;

          const screen = document.createElement('div');
          screen.className = 'screen';
          screen.style.width = '100%';
          screen.style.height = 'auto';
          screen.appendChild(canvas);

          const box = document.createElement('div');
          box.className = 'selection-box';
          box.style.top = '10%';
          box.style.left = '10%';
          box.style.width = '80%';
          box.style.height = '80%';
          box.innerHTML = `
            <div class="handle top-left" data-corner="tl"></div>
            <div class="handle top-right" data-corner="tr"></div>
            <div class="handle bottom-left" data-corner="bl"></div>
            <div class="handle bottom-right" data-corner="br"></div>
          `;
          screen.appendChild(box);

          const checkbox = document.createElement('label');
          checkbox.className = 'page-checkbox';
          checkbox.innerHTML = `<input type="checkbox" data-page="${i}" checked /> Page ${i}`;
          screen.appendChild(checkbox);

          pdfContainer.appendChild(screen);

          makeResizableDraggable(box);
          selectionBoxes.push({ box, canvas, pageNumber: i, checkbox });
        }
      } catch (error) {
        console.error(error);
        alert('Error loading PDF: ' + error.message);
      }
    }

    function makeResizableDraggable(box) {
      let isDragging = false;
      let isResizing = false;
      let startX, startY, startWidth, startHeight, startLeft, startTop, corner;
      const handles = box.querySelectorAll('.handle');

      function getClientXY(e) {
        return e.touches ? { x: e.touches[0].clientX, y: e.touches[0].clientY } : { x: e.clientX, y: e.clientY };
      }

      function onMove(e) {
        const { x, y } = getClientXY(e);
        const dx = x - startX;
        const dy = y - startY;

        if (isResizing) {
          let newWidth = startWidth, newHeight = startHeight, newLeft = startLeft, newTop = startTop;
          switch (corner) {
            case 'tl': newWidth -= dx; newHeight -= dy; newLeft += dx; newTop += dy; break;
            case 'tr': newWidth += dx; newHeight -= dy; newTop += dy; break;
            case 'bl': newWidth -= dx; newHeight += dy; newLeft += dx; break;
            case 'br': newWidth += dx; newHeight += dy; break;
          }
          box.style.width = Math.max(20, newWidth) + 'px';
          box.style.height = Math.max(20, newHeight) + 'px';
          box.style.left = newLeft + 'px';
          box.style.top = newTop + 'px';
        } else if (isDragging) {
          box.style.left = startLeft + dx + 'px';
          box.style.top = startTop + dy + 'px';
        }
      }

      function stop() {
        isDragging = false;
        isResizing = false;
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', stop);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend', stop);
      }

      function startDrag(e) {
        if (e.target.classList.contains("handle")) return;
        e.preventDefault();
        isDragging = true;
        const { x, y } = getClientXY(e);
        startX = x; startY = y;
        startLeft = box.offsetLeft; startTop = box.offsetTop;
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', stop);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('touchend', stop);
      }

      function startResize(e) {
        e.preventDefault();
        isResizing = true;
        corner = e.target.dataset.corner;
        const { x, y } = getClientXY(e);
        startX = x; startY = y;
        const rect = box.getBoundingClientRect();
        startWidth = rect.width; startHeight = rect.height;
        startLeft = box.offsetLeft; startTop = box.offsetTop;
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', stop);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('touchend', stop);
      }

      box.addEventListener('mousedown', startDrag);
      box.addEventListener('touchstart', startDrag, { passive: false });
      handles.forEach(handle => {
        handle.addEventListener('mousedown', startResize);
        handle.addEventListener('touchstart', startResize, { passive: false });
      });
    }

    async function cropAndDownload() {
      if (!loadedPdf) {
        alert('Please load a PDF first');
        return;
      }

      const pdfDoc = await PDFLib.PDFDocument.create();
      const option = cropOption.value;

      let masterBox = null;
      if (option === 'same') masterBox = selectionBoxes[0].box;

      // Show modal with progress
      modal.style.display = 'flex';
      let processedPages = 0;
      const totalPages = option === 'select' 
        ? selectionBoxes.filter(item => item.checkbox.querySelector('input').checked).length
        : selectionBoxes.length;

      for (const item of selectionBoxes) {
        const { box, canvas, checkbox, pageNumber } = item;
        if (option === 'select' && !checkbox.querySelector('input').checked) continue;

        // Update progress
        processedPages++;
        const progress = Math.round((processedPages / totalPages) * 100);
        modalProgressBar.style.width = `${progress}%`;
        modalProgressText.textContent = `${progress}% complete (page ${pageNumber} of ${loadedPdf.numPages})`;

        const ctx = canvas.getContext('2d');
        const scale = canvas.width / canvas.offsetWidth;

        const refBox = (option === 'same') ? masterBox : box;
        const x = refBox.offsetLeft * scale;
        const y = refBox.offsetTop * scale;
        const width = refBox.offsetWidth * scale;
        const height = refBox.offsetHeight * scale;

        // Create a new canvas with the cropped area
        const newCanvas = document.createElement('canvas');
        newCanvas.width = width;
        newCanvas.height = height;
        newCanvas.getContext('2d').drawImage(canvas, x, y, width, height, 0, 0, width, height);

        // Convert to image and embed in PDF with A4 size and margins
        const imgBytes = await newCanvas.toDataURL('image/png');
        const img = await pdfDoc.embedPng(imgBytes);
        
        // A4 dimensions in points (1pt = 1/72 inch)
        const a4Width = 595.28;  // 210mm
        const a4Height = 841.89; // 297mm
        const margin = 36;       // 0.5 inch margin
        
        // Calculate dimensions to maintain aspect ratio
        let imgWidth = a4Width - (2 * margin);
        let imgHeight = (img.height / img.width) * imgWidth;
        
        // If image is too tall, scale down to fit height
        if (imgHeight > (a4Height - (2 * margin))) {
          imgHeight = a4Height - (2 * margin);
          imgWidth = (img.width / img.height) * imgHeight;
        }
        
        // Center the image on the page
        const xPos = (a4Width - imgWidth) / 2;
        const yPos = (a4Height - imgHeight) / 2;
        
        const page = pdfDoc.addPage([a4Width, a4Height]);
        page.drawImage(img, {
          x: xPos,
          y: yPos,
          width: imgWidth,
          height: imgHeight,
        });
      }

      // Finalize and download
      modalProgressText.textContent = 'Finalizing PDF...';
      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cropped.pdf';
      a.click();
      
      // Hide modal after a short delay
      setTimeout(() => {
        modal.style.display = 'none';
      }, 1000);
    }
  </script>
</body>
</html>